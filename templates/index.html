<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Activity Recognition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 2rem;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .result-card {
            display: none;
        }
        .sensor-input {
            margin-bottom: 1rem;
            padding: 10px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }
        .btn-primary {
            background-color: #0d6efd;
            border: none;
            padding: 10px 20px;
        }
        .btn-primary:hover {
            background-color: #0b5ed7;
        }
        .sample-data-btn {
            margin: 5px;
        }
        .activity-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .instructions {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .instruction-section {
            margin-bottom: 20px;
        }
        .instruction-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .instruction-section ul {
            margin-left: 20px;
        }
        .instruction-section li {
            margin-bottom: 5px;
        }
        .activity-description {
            margin: 20px 0;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border: 1px solid #b8d8e8;
        }
        .activity-description h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .activity-description ul {
            margin-left: 20px;
        }
        .activity-description li {
            margin-bottom: 5px;
        }
        .confidence-bar {
            height: 20px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            background-color: #0d6efd;
            transition: width 0.3s ease;
        }
        .confidence-table th {
            background-color: #f8f9fa;
        }
        .confidence-table td {
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title text-center mb-4">Human Activity Recognition</h2>
                        
                        <div class="mb-4">
                            <h5>Enter Sensor Data</h5>
                            <p class="text-muted">Enter x, y, z coordinates from your sensor data or use sample data:</p>
                            
                            <!-- Sample Data Buttons -->
                            <div class="mb-3">
                                <h6>Sample Activities:</h6>
                                <button class="btn btn-outline-primary sample-data-btn" onclick="loadSampleData('walking')">Walking</button>
                                <button class="btn btn-outline-primary sample-data-btn" onclick="loadSampleData('running')">Running</button>
                                <button class="btn btn-outline-primary sample-data-btn" onclick="loadSampleData('sitting')">Sitting</button>
                                <button class="btn btn-outline-primary sample-data-btn" onclick="loadSampleData('standing')">Standing</button>
                                <button class="btn btn-outline-primary sample-data-btn" onclick="loadSampleData('laying')">Laying</button>
                            </div>
                            
                            <form id="sensor-form" onsubmit="return false;">
                                <div id="sensor-inputs">
                                    <div class="sensor-input row">
                                        <div class="col">
                                            <input type="number" class="form-control x-axis" placeholder="X-axis" step="0.01" required>
                                        </div>
                                        <div class="col">
                                            <input type="number" class="form-control y-axis" placeholder="Y-axis" step="0.01" required>
                                        </div>
                                        <div class="col">
                                            <input type="number" class="form-control z-axis" placeholder="Z-axis" step="0.01" required>
                                        </div>
                                        <div class="col-auto">
                                            <button type="button" class="btn btn-danger" onclick="removeSensorInput(this)">Remove</button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            
                            <button class="btn btn-secondary mt-2" onclick="addSensorInput()">Add More Data Points</button>
                        </div>

                        <div class="text-center">
                            <button class="btn btn-primary" onclick="predictActivity()">Predict Activity</button>
                        </div>

                        <div class="result-card card mt-4">
                            <div class="card-body">
                                <h4 class="card-title">Prediction Result</h4>
                                <div class="row">
                                    <div class="col-md-12">
                                        <p>Activity: <span id="predicted-activity" class="fw-bold"></span></p>
                                        <p>Confidence: <span id="confidence" class="fw-bold"></span></p>
                                        <p>Number of Samples: <span id="num-samples" class="fw-bold"></span></p>
                                        <p>Prediction Time: <span id="prediction-time" class="fw-bold"></span></p>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h5>Activity Probabilities</h5>
                                    <div id="confidence-breakdown" class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Activity</th>
                                                    <th>Probability</th>
                                                    <th>Final Score</th>
                                                </tr>
                                            </thead>
                                            <tbody id="confidence-table-body">
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="activity-info">
                            <h5>About the Activities:</h5>
                            <ul>
                                <li><strong>Walking:</strong> Regular walking motion with moderate acceleration</li>
                                <li><strong>Running:</strong> Faster motion with higher acceleration values</li>
                                <li><strong>Sitting:</strong> Stationary position with minimal movement</li>
                                <li><strong>Standing:</strong> Upright position with very little movement</li>
                                <li><strong>Laying:</strong> Horizontal position with minimal movement</li>
                            </ul>
                        </div>

                        <div class="activity-description">
                            <h3>Activity Descriptions</h3>
                            <p>Each activity has specific accelerometer patterns:</p>
                            <ul>
                                <li><strong>Walking:</strong> Moderate acceleration variations (0.8-5.0 m/s²) with significant Y-axis movement</li>
                                <li><strong>Running:</strong> High acceleration variations (>3.0 m/s²) with large Y-axis movement</li>
                                <li><strong>Sitting:</strong> Low movement (<0.4 m/s²) with forward tilt (1.0-2.0 m/s²)</li>
                                <li><strong>Standing:</strong> Very low movement (<0.3 m/s²) with minimal tilt</li>
                                <li><strong>Laying:</strong> Low movement with strong Y-axis gravity and minimal Z-axis gravity</li>
                            </ul>
                        </div>

                        <div class="instructions">
                            <h3>How to Use</h3>
                            <div class="instruction-section">
                                <h4>Default Values</h4>
                                <p>The sample buttons load pre-defined accelerometer patterns:</p>
                                <ul>
                                    <li><strong>Walking Sample:</strong> Moderate variations [0.69, 10.8, -2.03] to [0.75, 9.12, -1.8]</li>
                                    <li><strong>Running Sample:</strong> High variations [2.15, 15.2, -3.45] to [2.85, 15.0, -3.0]</li>
                                    <li><strong>Sitting Sample:</strong> Low movement with forward tilt [0.12, 1.5, 9.65] to [0.12, 1.4, 9.65]</li>
                                    <li><strong>Standing Sample:</strong> Minimal movement [0.15, 0.20, 9.81] to [0.14, 0.20, 9.81]</li>
                                    <li><strong>Laying Sample:</strong> Horizontal position [0.05, 9.81, 0.08] to [0.05, 9.81, 0.07]</li>
                                </ul>
                            </div>

                            <div class="instruction-section">
                                <h4>Adding Data Points</h4>
                                <p>When you add more data points:</p>
                                <ul>
                                    <li>Each new point should follow the pattern of the activity</li>
                                    <li>For stationary activities (Sitting/Standing/Laying), keep variations small (<0.3 m/s²)</li>
                                    <li>For dynamic activities (Walking/Running), maintain consistent movement patterns</li>
                                    <li>The confidence score considers both the model prediction and pattern matching</li>
                                </ul>
                            </div>

                            <div class="instruction-section">
                                <h4>Confidence Score</h4>
                                <p>The confidence score is calculated based on:</p>
                                <ul>
                                    <li>Model prediction (60% weight)</li>
                                    <li>Pattern matching (40% weight)</li>
                                    <li>Number of data points (reduced confidence for <5 points)</li>
                                    <li>Similarity to other activities (reduced for ambiguous cases)</li>
                                </ul>
                                <p>Note: Confidence is capped at 99% to acknowledge inherent uncertainty</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample data for different activities with movement intensity
        const sampleData = {
            walking: [
                {x: 0.69, y: 10.8, z: -2.03, movement_intensity: 5.2},
                {x: 6.85, y: 7.44, z: -0.5, movement_intensity: 4.8},
                {x: 0.93, y: 5.63, z: -0.5, movement_intensity: 4.5},
                {x: 1.25, y: 8.45, z: -1.2, movement_intensity: 5.0},
                {x: 0.75, y: 9.12, z: -1.8, movement_intensity: 4.9}
            ],
            running: [
                {x: 2.15, y: 15.2, z: -3.45, movement_intensity: 8.5},
                {x: 8.75, y: 12.3, z: -2.1, movement_intensity: 8.2},
                {x: 3.25, y: 14.8, z: -2.8, movement_intensity: 8.7},
                {x: 4.12, y: 13.5, z: -3.2, movement_intensity: 8.4},
                {x: 2.85, y: 15.0, z: -3.0, movement_intensity: 8.6}
            ],
            sitting: [
                {x: 0.12, y: 1.5, z: 9.65, movement_intensity: 0.5},
                {x: 0.10, y: 1.4, z: 9.64, movement_intensity: 0.4},
                {x: 0.11, y: 1.45, z: 9.63, movement_intensity: 0.4},
                {x: 0.13, y: 1.48, z: 9.65, movement_intensity: 0.5},
                {x: 0.12, y: 1.47, z: 9.64, movement_intensity: 0.4}
            ],
            standing: [
                {x: 0.15, y: 0.20, z: 9.81, movement_intensity: 0.2},
                {x: 0.14, y: 0.18, z: 9.82, movement_intensity: 0.2},
                {x: 0.16, y: 0.19, z: 9.81, movement_intensity: 0.2},
                {x: 0.15, y: 0.21, z: 9.80, movement_intensity: 0.2},
                {x: 0.14, y: 0.20, z: 9.81, movement_intensity: 0.2}
            ],
            laying: [
                {x: 0.05, y: 9.81, z: 0.08, movement_intensity: 0.1},
                {x: 0.06, y: 9.82, z: 0.07, movement_intensity: 0.1},
                {x: 0.05, y: 9.81, z: 0.09, movement_intensity: 0.1},
                {x: 0.06, y: 9.80, z: 0.08, movement_intensity: 0.1},
                {x: 0.05, y: 9.81, z: 0.07, movement_intensity: 0.1}
            ]
        };

        function loadSampleData(activity) {
            // Clear existing inputs
            document.getElementById('sensor-inputs').innerHTML = '';
            
            // Add sample data points
            sampleData[activity].forEach(point => {
                const newRow = createSensorInputRow();
                document.getElementById('sensor-inputs').appendChild(newRow);
                
                const inputs = newRow.querySelectorAll('input');
                inputs[0].value = point.x;
                inputs[1].value = point.y;
                inputs[2].value = point.z;
                
                // Set movement intensity as a data attribute
                newRow.dataset.movementIntensity = point.movement_intensity || 0;
            });
        }

        function createSensorInputRow() {
            const div = document.createElement('div');
            div.className = 'sensor-input row';
            div.dataset.movementIntensity = '0'; // Default movement intensity
            div.innerHTML = `
                <div class="col">
                    <input type="number" class="form-control x-axis" placeholder="X-axis" step="0.01" required>
                </div>
                <div class="col">
                    <input type="number" class="form-control y-axis" placeholder="Y-axis" step="0.01" required>
                </div>
                <div class="col">
                    <input type="number" class="form-control z-axis" placeholder="Z-axis" step="0.01" required>
                </div>
                <div class="col-auto">
                    <button type="button" class="btn btn-danger" onclick="removeSensorInput(this)">Remove</button>
                </div>
            `;
            return div;
        }

        function addSensorInput() {
            const newRow = createSensorInputRow();
            document.getElementById('sensor-inputs').appendChild(newRow);
        }

        function removeSensorInput(button) {
            const sensorInputs = document.querySelectorAll('.sensor-input');
            if (sensorInputs.length > 1) {
                button.closest('.sensor-input').remove();
            } else {
                alert('You must keep at least one data point');
            }
        }

        function validateInputs() {
            let isValid = true;
            document.querySelectorAll('.sensor-input').forEach(input => {
                const x = input.querySelector('.x-axis').value;
                const y = input.querySelector('.y-axis').value;
                const z = input.querySelector('.z-axis').value;
                
                if (!x || !y || !z) {
                    isValid = false;
                }
            });
            return isValid;
        }

        function predictActivity() {
            if (!validateInputs()) {
                alert('Please fill in all sensor values');
                return;
            }

            const sensorInputs = document.querySelectorAll('.sensor-input');
            const sensorData = [];

            sensorInputs.forEach(input => {
                const x = parseFloat(input.querySelector('.x-axis').value);
                const y = parseFloat(input.querySelector('.y-axis').value);
                const z = parseFloat(input.querySelector('.z-axis').value);

                if (!isNaN(x) && !isNaN(y) && !isNaN(z)) {
                    sensorData.push([x, y, z]);
                }
            });

            if (sensorData.length === 0) {
                alert('Please enter at least one valid sensor reading');
                return;
            }

            // Show loading state
            const predictButton = document.querySelector('button.btn-primary');
            const originalText = predictButton.textContent;
            predictButton.textContent = 'Predicting...';
            predictButton.disabled = true;

            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ sensor_data: sensorData })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.error || 'Server error');
                    });
                }
                return response.json();
            })
            .then(data => {
                console.log('Prediction response:', data);
                
                // Update the result card
                document.querySelector('.result-card').style.display = 'block';
                document.getElementById('predicted-activity').textContent = data.prediction;
                document.getElementById('confidence').textContent = `${(data.confidence * 100).toFixed(2)}%`;
                document.getElementById('num-samples').textContent = sensorData.length;
                document.getElementById('prediction-time').textContent = `${data.prediction_time.toFixed(2)}s`;

                // Update probabilities
                const tbody = document.getElementById('confidence-table-body');
                tbody.innerHTML = '';
                
                Object.entries(data.probabilities).forEach(([activity, probability]) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${activity}</td>
                        <td>${(probability * 100).toFixed(2)}%</td>
                        <td>${(probability * 100).toFixed(2)}%</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(error => {
                console.error('Error:', error);
                alert(error.message || 'Error predicting activity');
                document.querySelector('.result-card').style.display = 'none';
            })
            .finally(() => {
                // Reset button state
                predictButton.textContent = originalText;
                predictButton.disabled = false;
            });
        }
    </script>
</body>
</html> 